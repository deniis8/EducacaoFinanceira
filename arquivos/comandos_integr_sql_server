USE master
GO
DROP DATABASE LANCAMENTOS;
CREATE DATABASE LANCAMENTOS
ON
(
name = 'LANCAMENTOS',
filename = 'C:\EducacaoFinanceira\integracao_sql_server\banco_sql_server\LANCAMENTOS.mdf',
SIZE = 60 MB
)
LOG ON
(
name ='LANCAMENTOS_LOG',
filename = 'C:\EducacaoFinanceira\integracao_sql_server\banco_sql_server\LANCAMENTOS_LOG.LDF',
SIZE = 60 MB
);

USE LANCAMENTOS 
GO

CREATE TABLE LANCAMENTOS (
    ID_LANC    INTEGER,
    DATA       DATE,
    HORA       VARCHAR(8),
    VALOR      NUMERIC(7, 2),
    DESCRICAO  VARCHAR(50),
    ID_CCUSTO  INTEGER,
    [STATUS]   VARCHAR (20),
    D_E_L_E_T_ CHAR (1)
	CONSTRAINT FK_ID_LANC PRIMARY KEY(ID_LANC) 
);

--DROP TABLE CCUSTO
CREATE TABLE CCUSTO (
    ID_CCUSTO  INTEGER,
    DESCRIHH   VARCHAR(50),
    D_E_L_E_T_ CHAR (1) 
	CONSTRAINT PK_ID_CCUSTO PRIMARY KEY(ID_CCUSTO)
);

--DROP TABLE SALDOS
CREATE TABLE SALDOS (
    ID_SALDO  INTEGER,
    DATA      DATE    NOT NULL,
    HORA	  VARCHAR(8),
    VALORLAN  NUMERIC (10,2),
    DESCRILAN VARCHAR (50),
    SALDO     NUMERIC (10,2) NOT NULL,
    CCUSTO    VARCHAR (30),
    [STATUS]  VARCHAR (20) 
	CONSTRAINT PK_ID_SALDO PRIMARY KEY(ID_SALDO)
);


TRUNCATE TABLE LANCAMENTOS
BULK INSERT LANCAMENTOS
FROM 'C:\EducacaoFinanceira\integracao_sql_server\Lancamentos.txt' 
WITH (CODEPAGE='ACP', FIELDTERMINATOR=';;',ROWTERMINATOR='//');

TRUNCATE TABLE CCUSTO
BULK INSERT CCUSTO
FROM 'C:\EducacaoFinanceira\integracao_sql_server\CCusto.txt' 
WITH (CODEPAGE='ACP', FIELDTERMINATOR=';;',ROWTERMINATOR='//');

TRUNCATE TABLE SALDOS
BULK INSERT SALDOS
FROM 'C:\EducacaoFinanceira\integracao_sql_server\Saldos.txt' 
WITH (CODEPAGE='ACP', FIELDTERMINATOR=';;',ROWTERMINATOR='//');


--SELECT * FROM SALDOS WHERE DATA BETWEEN '2020-07-01' AND '2020-07-31' AND [STATUS]='Pago' ORDER BY DATA, HORA

BACKUP DATABASE LANCAMENTOS TO DISK = 'C:\EducacaoFinanceira\integracao_sql_server\banco_sql_server\backup\LANCAMENTOS.bak'
RESTORE DATABASE LANCAMENTOS FROM DISK = 'C:\EducacaoFinanceira\integracao_sql_server\banco_sql_server\backup\LANCAMENTOS.bak'